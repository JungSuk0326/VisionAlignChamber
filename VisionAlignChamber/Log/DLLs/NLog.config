<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:autoReload="true"
      throwExceptions="false"
      internalLogLevel="Off">

  <!-- 변수 정의: 애플리케이션 실행 경로 기준 -->
  <variable name="logDirectory" value="${basedir}/Logs"/>

  <!-- 로그 출력 대상 정의 -->
  <targets async="true">
    <!-- 콘솔 출력 -->
    <target xsi:type="Console"
            name="console"
            layout="${longdate} ${uppercase:${level}} [${logger:shortName=true}] ${message} ${exception:format=tostring}" />

    <!-- 파일 출력 (날짜별 분리) -->
    <target xsi:type="File"
            name="file"
            fileName="${logDirectory}/${shortdate}.log"
            layout="${longdate} ${uppercase:${level}} [${logger}] ${message} ${exception:format=tostring}"
            archiveAboveSize="10485760"
            archiveEvery="Day"
            archiveNumbering="Rolling"
            maxArchiveFiles="30"
            concurrentWrites="true"
            keepFileOpen="false" />

    <!-- 에러 전용 파일 -->
    <target xsi:type="File"
            name="errorfile"
            fileName="${logDirectory}/Errors/${shortdate}-errors.log"
            layout="${longdate} ${uppercase:${level}} [${logger}] ${message} ${exception:format=tostring,stacktrace,data:maxInnerExceptionLevel=10}" />

    <!-- 디버그 출력 (Visual Studio Output 창) -->
    <target xsi:type="Debugger"
            name="debugger"
            layout="${logger}::${message}" />

    <!-- 시스템 로그 -->
    <target xsi:type="File"
            name="System"
            fileName="${logDirectory}/System/System_${date:format=yyyy-MM-dd_HH}.log"
            layout="[${level}] ${time:format=HH\:mm\:ss\.fff} [${logger}] ${message}"
            maxArchiveFiles="168"
            archiveEvery="Hour"
            archiveAboveSize="10485760" />

    <!-- 모션 로그 -->
    <target xsi:type="File"
            name="Motion"
            fileName="${logDirectory}/Motion/Motion_${date:format=yyyy-MM-dd_HH}.log"
            layout="[${level}] ${time:format=HH\:mm\:ss\.fff} [${logger}] ${message}"
            maxArchiveFiles="168"
            archiveEvery="Hour"
            archiveAboveSize="10485760" />

    <!-- I/O 로그 -->
    <target xsi:type="File"
            name="IO"
            fileName="${logDirectory}/IO/IO_${date:format=yyyy-MM-dd_HH}.log"
            layout="[${level}] ${time:format=HH\:mm\:ss\.fff} [${logger}] ${message}"
            maxArchiveFiles="168"
            archiveEvery="Hour"
            archiveAboveSize="10485760" />

    <!-- 비전 로그 -->
    <target xsi:type="File"
            name="Vision"
            fileName="${logDirectory}/Vision/Vision_${date:format=yyyy-MM-dd_HH}.log"
            layout="[${level}] ${time:format=HH\:mm\:ss\.fff} [${logger}] ${message}"
            maxArchiveFiles="168"
            archiveEvery="Hour"
            archiveAboveSize="10485760" />

    <!-- 알람 로그 -->
    <target xsi:type="File"
            name="Alarm"
            fileName="${logDirectory}/Alarm/Alarm_${date:format=yyyy-MM-dd_HH}.log"
            layout="[${level}] ${time:format=HH\:mm\:ss\.fff} [${logger}] ${message}"
            maxArchiveFiles="720"
            archiveEvery="Hour"
            archiveAboveSize="10485760" />

    <!-- 시퀀스 로그 -->
    <target xsi:type="File"
            name="Sequence"
            fileName="${logDirectory}/Sequence/Sequence_${date:format=yyyy-MM-dd_HH}.log"
            layout="[${level}] ${time:format=HH\:mm\:ss\.fff} [${logger}] ${message}"
            maxArchiveFiles="168"
            archiveEvery="Hour"
            archiveAboveSize="10485760" />

    <!-- 데이터베이스 로그 -->
    <target xsi:type="File"
            name="DB"
            fileName="${logDirectory}/DB/DB_${date:format=yyyy-MM-dd_HH}.log"
            layout="[${level}] ${time:format=HH\:mm\:ss\.fff} [${logger}] ${message}"
            maxArchiveFiles="168"
            archiveEvery="Hour"
            archiveAboveSize="10485760" />

    <!-- 추적 로그 -->
    <target xsi:type="File"
            name="Trace"
            fileName="${logDirectory}/Trace/Trace_${date:format=yyyy-MM-dd_HH}.log"
            layout="[${level}] ${time:format=HH\:mm\:ss\.fff} [${logger}] ${message}"
            maxArchiveFiles="72"
            archiveEvery="Hour"
            archiveAboveSize="10485760" />
  </targets>

  <!-- 로깅 규칙 -->
  <rules>
    <!-- 모든 로그를 콘솔과 기본 파일로 -->
    <logger name="*" minlevel="Debug" writeTo="console,file" />

    <!-- 에러 이상은 에러 전용 파일로도 -->
    <logger name="*" minlevel="Error" writeTo="errorfile" />

    <!-- 디버그 모드에서만 디버거 출력 -->
    <logger name="*" minlevel="Debug" writeTo="debugger" />

    <!-- 카테고리별 로깅 규칙 -->
    <logger name="System" minlevel="Debug" writeTo="System" />
    <logger name="Motion" minlevel="Debug" writeTo="Motion" />
    <logger name="IO" minlevel="Debug" writeTo="IO" />
    <logger name="Vision" minlevel="Debug" writeTo="Vision" />
    <logger name="Alarm" minlevel="Debug" writeTo="Alarm" />
    <logger name="Sequence" minlevel="Debug" writeTo="Sequence" />
    <logger name="DB" minlevel="Debug" writeTo="DB" />
    <logger name="Trace" minlevel="Debug" writeTo="Trace" />
  </rules>
</nlog>
